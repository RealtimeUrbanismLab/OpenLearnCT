!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();let e=-1;function t(){return e}function i(t){return e=t,t}const n=[{Index:"0",Modelname:"boxes",Title:"Boxes",Description:"The Boxes!"},{Index:"1",Modelname:"gantry_housing",Title:"Gantry Housing",Description:"The gantry houses the rotating X-ray tube and detectors, as well as control electronics. Its open circular aperture is where the patient table is positioned. The gantry tilts in some designs, allowing angled imaging to optimize anatomy visualization."},{Index:"2",Modelname:"gantry_ring",Title:"Gantry Ring",Description:"The rotating frame supports key imaging components — the X-ray tube and detector array — enabling them to revolve rapidly around the patient for multi-angle projections. High-speed, stable rotation is crucial for minimizing motion artifacts."},{Index:"3",Modelname:"xray_tube",Title:"X-Ray Tube",Description:"The X-ray tube generates the fan-shaped X-ray beam used in CT imaging. Electrons are accelerated from the cathode filament to the metal anode, producing X-rays via Bremsstrahlung and characteristic emissions. Cooling systems remove heat generated during rapid exposures."},{Index:"4",Modelname:"detector_array",Title:"Detector Array",Description:"The detector array measures the transmitted X-rays after they pass through the patient. Modern detectors use scintillation crystals coupled to photodiodes to convert X-ray energy into digital signals. Detector speed, efficiency, and resolution are central to image quality."},{Index:"5",Modelname:"slip_ring_assembly",Title:"Slip Ring Assembly",Description:"Slip rings supply electrical power and transmit data between the stationary and rotating structures of the CT scanner. This innovation allows continuous scanning without cable winding, making spiral (helical) CT possible."},{Index:"6",Modelname:"collimators",Title:"Collimators",Description:"Collimators narrow the X-ray beam into a fan or cone shape, reducing radiation outside the imaging region and optimizing slice thickness. Pre-patient collimators shape the beam before it reaches the body, while post-patient collimators reduce scatter before the detectors."},{Index:"7",Modelname:"bore",Title:"Bore",Description:"The bore is the opening in the CT scanner through which the patient is positioned. Bore diameter impacts patient comfort and how large a scanning field can be achieved."},{Index:"8",Modelname:"patient_table",Title:"Patient Table",Description:"The motorized table moves the patient continuously or incrementally during scanning. Its movement must be precise to synchronize with the X-ray beam for accurate reconstruction, especially in helical scanning."},{Index:"9",Modelname:"control_console",Title:"Control Console",Description:"The control console is operated by the technologist to input scanning protocols, initiate scans, and review preliminary images. Protocol parameters affect dose, image resolution, and scan time."},{Index:"10",Modelname:"image_reconstruction_computer",Title:"Image Reconstruction Computer",Description:"High-speed computers process raw projection data into cross-sectional images using mathematical algorithms such as filtered back-projection or iterative reconstruction. Processing speed and algorithm quality directly impact image clarity and diagnostic value."},{Index:"11",Modelname:"control_room",Title:"Control Room",Description:"CT technologists operate the scanner from a shielded control room to protect from ionizing radiation, while maintaining visual and audio contact with the patient."},{Index:"12",Modelname:"cooling_system",Title:"Cooling System",Description:"CT scanners generate significant heat during operation, primarily at the X-ray tube. Cooling systems (oil or liquid-based) dissipate heat, allowing rapid successive scans without damaging the tube."},{Index:"13",Modelname:"laser_positioning_lights",Title:"Laser Positioning Lights",Description:"Laser alignment facilitates precise patient positioning for radiotherapy, which can be adjusted as needed during radiotherapy simulation."},{Index:"14",Modelname:"safety_and_intercom_systems",Title:"Safety and Intercom Systems",Description:"These systems enable the operator to communicate with patients during scans, provide instructions, and intervene promptly if necessary."}],o=new Map;function s(e,t,i=!1){const n=e.getObject3D("mesh");n&&n.traverse(e=>{if(e.isMesh)if(o.has(e)||o.set(e,{transparent:e.material.transparent,opacity:e.material.opacity,color:e.material.color.clone()}),e.material.transparent=!0,e.material.opacity=t,i)e.material.color.set(16711680);else{const t=o.get(e);e.material.color.copy(t.color)}})}function a(e){document.querySelectorAll(".cantap").forEach(t=>{t.id===e?s(t,1,!0):s(t,.3)})}function r(){const e=document.querySelectorAll(".cantap");document.querySelectorAll(".cantap").forEach(e=>{const t=e.getObject3D("mesh");t&&t.traverse(e=>{e.isMesh&&!o.has(e)&&o.set(e,{transparent:e.material.transparent,opacity:e.material.opacity,color:e.material.color.clone()})})}),e.forEach(e=>{"group"!==e.id&&e.addEventListener("click",()=>{const t=e.id,o=n.findIndex(e=>e.Modelname===t);i(o),-1!==o&&(c(o,n),a(t),l())})})}function c(e,t){const i=document.getElementById("popup"),n=document.getElementById("popup-title"),s=document.getElementById("popup-content"),a=document.getElementById("close-popup");if(e>=0&&e<t.length){const{Title:o,Subtitle:a,Description:r}=t[e];let c=`\n        <div class="title">${o}</div>\n    `;a&&(c+=`<div class="subtitle">${a}</div>`),n.innerHTML=c;const l=r.split("\n\n");let d="";d+='<div class="content">',l.forEach(e=>{""!==e.trim()&&(d+=`<p>${e}</p>`)}),d+="</div>",d+="</div>",s.innerHTML=d,i.style.display="flex"}a.onclick=()=>{i.style.display="none",o.forEach((e,t)=>{t.material.transparent=e.transparent,t.material.opacity=e.opacity,t.material.color.copy(e.color)})}}const l=()=>{const e=document.getElementById("nextbutton"),i=document.getElementById("backbutton"),o=t();i.style.display=o>0?"inline-block":"none",e.style.display=o<n.length-1?"inline-block":"none"},d=()=>({init(){let e=!1;const o=document.getElementById("startbutton"),s=document.getElementById("placebutton"),d=document.getElementById("message");d.style.display="block",o.style.display="block";o.onclick=()=>{e||(e=!0,o.style.display="none",s.style.display="block",d.style.display="none",(()=>{const e=document.querySelectorAll(".cantap"),t=document.getElementById("group");e.forEach(e=>{const i=e.cloneNode(!0);t.appendChild(i),e.remove()}),t.setAttribute("gesture-handler","")})())},s.onclick=()=>{s.style.display="none",i(0),r(),l()};document.getElementById("nextbutton").onclick=()=>{const e=t();if(e<n.length-1){i(e+1);const o=n[e+1].Modelname;c(t(),n),l(),a(o)}};document.getElementById("backbutton").onclick=()=>{const e=t();if(e<n.length){i(e-1);const o=n[e-1].Modelname;c(t(),n),l(),a(o)}}}});let h=!1;const u={schema:{enabled:{default:!0},rotationFactor:{default:5}},init(){this.initialScale=this.el.object3D.scale.clone(),this.scaleFactor=1,this.isDragging=!1,this.previousPosition={x:0,y:0},this.pinchStartDistance=0,this.lastPinchDistance=0,this.initialRotation={x:0,y:0},this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.el.addEventListener("touchstart",this.onTouchStart),document.addEventListener("touchmove",this.onTouchMove,{passive:!1}),document.addEventListener("touchend",this.onTouchEnd),this.el.addEventListener("mousedown",this.onMouseDown),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)},onTouchStart(e){this.data.enabled&&(e.preventDefault(),1===e.touches.length?(this.isDragging=!0,this.previousPosition={x:e.touches[0].clientX,y:e.touches[0].clientY},this.initialRotation={x:this.el.object3D.rotation.x,y:this.el.object3D.rotation.y}):2===e.touches.length&&(this.isDragging=!1,this.pinchStartDistance=this.getDistanceBetweenTouches(e.touches),this.lastPinchDistance=this.pinchStartDistance))},onTouchMove(e){if(this.data.enabled)if(e.preventDefault(),1===e.touches.length&&this.isDragging){const t=e.touches[0].clientX-this.previousPosition.x,i=e.touches[0].clientY-this.previousPosition.y;this.el.object3D.rotation.y+=.01*t,this.el.object3D.rotation.x+=.01*i,this.previousPosition={x:e.touches[0].clientX,y:e.touches[0].clientY}}else if(2===e.touches.length){const t=this.getDistanceBetweenTouches(e.touches),i=t/this.lastPinchDistance;this.scaleFactor*=i,this.scaleFactor=Math.max(.5,Math.min(3,this.scaleFactor)),this.el.object3D.scale.copy(this.initialScale).multiplyScalar(this.scaleFactor),this.lastPinchDistance=t}},onTouchEnd(e){0===e.touches.length?this.isDragging=!1:1===e.touches.length&&(this.isDragging=!0,this.previousPosition={x:e.touches[0].clientX,y:e.touches[0].clientY})},onMouseDown(e){this.data.enabled&&(this.isDragging=!0,this.previousPosition={x:e.clientX,y:e.clientY},this.initialRotation={x:this.el.object3D.rotation.x,y:this.el.object3D.rotation.y},e.preventDefault())},onMouseMove(e){if(!this.data.enabled||!this.isDragging)return;const t=e.clientX-this.previousPosition.x,i=e.clientY-this.previousPosition.y;this.el.object3D.rotation.y+=.01*t,this.el.object3D.rotation.x+=.01*i,this.previousPosition={x:e.clientX,y:e.clientY},e.preventDefault()},onMouseUp(e){this.isDragging=!1},getDistanceBetweenTouches(e){const t=e[0].clientX-e[1].clientX,i=e[0].clientY-e[1].clientY;return Math.sqrt(t*t+i*i)},remove(){this.el.removeEventListener("touchstart",this.onTouchStart),document.removeEventListener("touchmove",this.onTouchMove),document.removeEventListener("touchend",this.onTouchEnd),this.el.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)}},m={init(){this.arButton=document.getElementById("ar-button"),this.arContainer=document.getElementById("ar-container"),this.scene=this.el,this.isPlaced=!1,this.reticle=null,navigator.xr?navigator.xr.isSessionSupported("immersive-ar").then(e=>{e?(this.arButton.style.display="block",this.arButton.addEventListener("click",()=>this.enterAR())):(console.log("AR not supported - falling back to 3D preview mode"),this.arButton.style.display="none")}).catch(e=>{console.log("WebXR check failed:",e),this.arButton.style.display="none"}):(console.log("WebXR not available - 3D preview mode only"),this.arButton.style.display="none")},async enterAR(){const e={requiredFeatures:["hit-test","local-floor"],optionalFeatures:["dom-overlay"],domOverlay:{root:document.body}};try{const t=await navigator.xr.requestSession("immersive-ar",e),i=this.scene.renderer;await i.xr.setSession(t),this.arContainer.object3D.visible=!1;const n=await t.requestReferenceSpace("viewer"),o=await t.requestHitTestSource({space:n});this.session=t,this.hitTestSource=o,this.createReticle(),t.addEventListener("select",e=>{this.isPlaced||this.placeModel(e)}),t.addEventListener("end",()=>{this.cleanup()}),this.startARLoop(t)}catch(t){console.error("Failed to start AR session:",t),alert("Could not start AR mode. Make sure you:\n1. Are using HTTPS\n2. Have a device that supports WebXR AR\n3. Granted camera permissions")}},createReticle(){const e=new THREE.RingGeometry(.15,.2,32).rotateX(-Math.PI/2),t=new THREE.MeshBasicMaterial({color:16777215});this.reticle=new THREE.Mesh(e,t),this.reticle.matrixAutoUpdate=!1,this.reticle.visible=!1,this.scene.object3D.add(this.reticle)},startARLoop(e){const t=this.scene.renderer;e.requestReferenceSpace("local-floor").then(e=>{t.xr.setAnimationLoop((t,i)=>{if(!i)return;if(i.getViewerPose(e)&&this.hitTestSource&&!this.isPlaced){const t=i.getHitTestResults(this.hitTestSource);if(t.length>0){const i=t[0].getPose(e);this.reticle&&i&&(this.reticle.visible=!0,this.reticle.matrix.fromArray(i.transform.matrix))}else this.reticle&&(this.reticle.visible=!1)}})})},placeModel(e){const t=e.frame;this.session.requestReferenceSpace("local-floor").then(e=>{const i=t.getHitTestResults(this.hitTestSource);if(i.length>0){const t=i[0].getPose(e);if(t){const e=t.transform.position;this.arContainer.setAttribute("position",{x:e.x,y:e.y,z:e.z}),this.arContainer.object3D.visible=!0,this.reticle&&(this.reticle.visible=!1),this.isPlaced=!0;const i=document.getElementById("message");i&&(i.innerHTML="<h1>Model Placed!</h1><p>You can now interact with the CT Scanner components.</p>",i.style.display="block",setTimeout(()=>{i.style.display="none"},3e3))}}})},cleanup(){this.reticle&&(this.scene.object3D.remove(this.reticle),this.reticle=null),this.hitTestSource=null,this.session=null,this.isPlaced=!1,this.arContainer&&(this.arContainer.object3D.visible=!0)}},p={init(){const e=document.getElementById("startbutton"),t=document.getElementById("message");document.getElementById("rotate-button");const i=document.getElementById("rotation_pivot");if(!e)return void console.warn("startButton: #startbutton not found");const n=n=>{n.preventDefault(),n.stopPropagation(),e.style.display="none",t&&(t.style.display="none"),i&&i.hasAttribute("animation__spin")&&i.setAttribute("animation__spin",{property:"rotation",from:"0 0 0",to:"0 360 0",loop:!0,dur:3e3,easing:"linear"}),console.log("Start pressed")};e.addEventListener("touchstart",n),e.addEventListener("click",n)}};function g(){const e=document.getElementById("loading-screen");e&&(e.style.opacity="0",e.style.transition="opacity 0.5s",setTimeout(()=>e.remove(),500))}(/^(iPad|iPhone|iPod)/.test(window.navigator.platform)||/^Mac/.test(window.navigator.platform)&&window.navigator.maxTouchPoints>1)&&(window.createImageBitmap=void 0),window.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("a-scene");e&&e.addEventListener("loaded",()=>{setTimeout(g,1e3)}),setTimeout(g,5e3),p.init()}),"undefined"!=typeof AFRAME&&(AFRAME.registerComponent("next-button",d()),AFRAME.registerComponent("rotate-button",{init(){const e=document.getElementById("rotate-button"),t=document.getElementById("rotation_pivot");e.addEventListener("click",()=>{h=!h,h?(e.textContent="Turn Off",t.setAttribute("animation__spin",{property:"rotation",to:"0 360 0",loop:!0,dur:5e3,easing:"linear"})):(e.textContent="Turn On",t.removeAttribute("animation__spin"))})}}),AFRAME.registerComponent("gesture-handler",u),AFRAME.registerComponent("ar-mode",m),AFRAME.registerComponent("selectcomponent",{init(){this.el.addEventListener("loaded",()=>{r()})}}));
